<?xml version="1.0"?>
<root main_tree_to_execute="MainTree">
    <!-- ////////// -->
    <BehaviorTree ID="MainTree">
        <Fallback>
            <Sequence name="setup">
                <Delay delay_msec="100">
                    <Action ID="RequestTriggerComponent" server_name="/behaviour/request_setup" server_timeout="100"/>
                </Delay>
                <SetBlackboard output_key="setup_complete" value="false"/>
                <ForceSuccess>
                    <Sequence>
                        <Action ID="SetBoolComponent" server_name="/stock_handler/load_stock" server_timeout="100" state="true"/>
                        <Action ID="SetBoolComponent" server_name="/stock_handler/attach_stock" server_timeout="100" state="true"/>
                    </Sequence>
                </ForceSuccess>
                <Action ID="TriggerComponent" server_name="/toolpath_handler/load_toolpath" server_timeout="100"/>
                <Action ID="TriggerComponent" server_name="/gripper_controller/close" server_timeout="100"/>
                <Action ID="TriggerComponent" server_name="/toolpath_planner/toolpath_setup" server_timeout="100"/>
                <SetBlackboard output_key="setup_complete" value="true"/>
            </Sequence>
            <Sequence name="execute">
                <Delay delay_msec="100">
                    <Action ID="RequestTriggerComponent" server_name="/behaviour/request_execute" server_timeout="100"/>
                </Delay>
                <BlackboardCheckBool return_on_mismatch="false" value_A="${setup_complete}" value_B="true">
                    <Sequence>
                        <Sequence>
                            <Action ID="SetBoolComponent" server_name="/us_cutter_controller/enable" server_timeout="100" state="true"/>
                            <Action ID="SetBoolComponent" server_name="/us_cutter_controller/activate" server_timeout="100" state="true"/>
                            <Action ID="TriggerComponent" server_name="/toolpath_planner/toolpath_execute" server_timeout="100"/>
                        </Sequence>
                        <Action ID="SetBoolComponent" server_name="/us_cutter_controller/activate" server_timeout="100" state="false"/>
                        <SetBlackboard output_key="setup_complete" value="false"/>
                    </Sequence>
                </BlackboardCheckBool>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="RequestTriggerComponent">
            <input_port name="server_name" type="std::string">Action server name</input_port>
            <input_port name="server_timeout" type="std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;"/>
        </Action>
        <Action ID="SetBoolComponent">
            <input_port name="server_name" type="std::string">Action server name</input_port>
            <input_port name="server_timeout" type="std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;"/>
            <input_port name="state" type="bool"/>
        </Action>
        <Action ID="TriggerComponent">
            <input_port name="server_name" type="std::string">Action server name</input_port>
            <input_port name="server_timeout" type="std::chrono::duration&lt;long, std::ratio&lt;1l, 1000l&gt; &gt;"/>
        </Action>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

